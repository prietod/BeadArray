#!/usr/bin/env bash

BASE="$(readlink -f $(readlink -f $(dirname "${BASH_SOURCE}")/../..))"

filter() {
  if [[ -n "$TEST" ]]; then
    head -7
  else
    cat
  fi
}

[[ $# -ne 2 ]] && echo "Usage: $( basename $0 ) <tree-a> <tree-b>" 1>&2

tree_a=$1
tree_b=$2

find $tree_a -type f | filter | sort | xargs md5sum | sed "s|$tree_a/||" > $BASE/tmp/tree-a.txt

find $tree_b -type f | filter | sort | xargs md5sum | sed "s|$tree_b/||" > $BASE/tmp/tree-b.txt

diff $BASE/tmp/tree-a.txt $BASE/tmp/tree-b.txt

