#!/usr/bin/env bash
#
# bin/util/get-mapinfo - returns all columns for a particular field

BASE="$(readlink -f $(readlink -f $(dirname "${BASH_SOURCE}")/../..))"

DATA_DIR="${DATA_DIR:-/hiidata/teddy/data/jinfiniti/gene_expression}"

MAP_INFO="${MAP_INFO:-$DATA_DIR/map_info.txt}"

usage() {
  echo "Usage: $( basename $0 ) [-u] <$( join \| $fields )>" 1>&2
  exit 1
}

strip_header() {
  sed -n '2,$p'
}

if [[ $1 == '-u' ]]; then
  filter="sort -u"
  shift
else
  filter="sort"
fi

fields="
subject_id
vial_barcode_number
test_name
donor_number
box
row
chip_barcode
array
draw_dte
sample_status
date_received_sample
date_of_evaluation
comments
"

declare -A field_map

for f in $fields; do
  field_map[$f]=$((++n))
done

[[ $# != 1 ]] && usage

strip_header < $MAP_INFO | awk -F'\t' "{ print \$${field_map[$1]} }" | $filter
