#!/usr/bin/env bash

set -x

MYDIR=$(readlink -f $(dirname $0))
MYBASE=$(readlink -f $MYDIR/..)

module load apps/R/3.2.3

chip_barcodes="
3998755068 
3998787078
"

for chip_barcode in ${chip_barcodes}; do
  [[ -d $MYBASE/tmp/test/data/${chip_barcode} ]] && continue

  mkdir -p $MYBASE/tmp/test/data/${chip_barcode}

  find /hiidata/teddy/data/jinfiniti/gene_expression | grep "${chip_barcode}_[A-L]\.txt" \
    | xargs -n1 -I% cp % $MYBASE/tmp/test/data/${chip_barcode}
done 


for d in $( ls $MYBASE/tmp/test/data ); do
  R --slave --quiet --no-restore --no-save --args $MYBASE/tmp/test/data/$d < $MYBASE/code/BeadArray_Import.R
done

